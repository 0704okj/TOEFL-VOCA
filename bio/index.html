<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TOEFL Biology Vocab Matching (Paging)</title>
  <style>
    :root { --gap: 10px; --radius: 14px; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#f6f7fb; color:#111; }
    header { padding: 18px 16px 8px; max-width: 1100px; margin: 0 auto; }
    h1 { margin: 0 0 8px; font-size: 18px; }
    .sub { display:flex; flex-wrap:wrap; gap:10px; align-items:center; font-size: 13px; color:#333; }
    .pill { background:#fff; border:1px solid #e7e7ef; border-radius:999px; padding:8px 10px; box-shadow: 0 1px 0 rgba(0,0,0,.03); }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 0 16px 18px; }
    .controls { display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin: 10px 0 14px; }
    button {
      border: 1px solid #dcdcec; background:#fff; padding:10px 12px;
      border-radius: 12px; cursor:pointer; font-weight:600;
      box-shadow: 0 1px 0 rgba(0,0,0,.03);
    }
    button:hover { filter: brightness(.98); }
    button:active { transform: translateY(1px); }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .pagination { display: flex; justify-content: center; align-items: center; gap: 20px; margin: 20px 0; }
    .page-info { font-weight: bold; font-size: 15px; }

    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: var(--gap); }
    @media (max-width: 820px) { .grid { grid-template-columns: 1fr; } }
    .col {
      background:#fff; border:1px solid #e7e7ef; border-radius: var(--radius);
      padding: 12px; box-shadow: 0 2px 10px rgba(0,0,0,.04);
    }
    .col h2 { margin: 2px 0 10px; font-size: 14px; color:#222; }
    .list { display:grid; grid-template-columns: 1fr; gap: 8px; min-height: 400px; }
    .card {
      border:1px solid #ececf5; border-radius: 12px; padding: 10px 12px;
      background:#fafbff; cursor:pointer; user-select:none;
      display:flex; justify-content:space-between; align-items:center; gap:12px;
      min-height: 20px;
    }
    .card small { color:#666; font-weight:600; }
    .card.selected { outline: 2px solid #4c7dff; background:#eef3ff; }
    .card.matched { background:#ecfff1; border-color:#bfe7c8; color:#0b5b22; cursor:default; opacity:.95; }
    .card.wrong { animation: shake .25s linear 0s 1; outline: 2px solid #ff4c4c; background:#ffecec; }
    @keyframes shake { 0%{transform:translateX(0)} 25%{transform:translateX(-3px)} 50%{transform:translateX(3px)} 75%{transform:translateX(-2px)} 100%{transform:translateX(0)} }
    
    .footer { margin-top: 12px; font-size: 12px; color:#555; }
    .progress { height: 10px; background:#eef0f7; border-radius:999px; overflow:hidden; border:1px solid #e6e7f1; }
    .bar { height:100%; width:0%; background: linear-gradient(90deg,#4c7dff,#8a5bff); transition: width .2s ease; }
  </style>
</head>
<body>
  <header>
    <h1>TOEFL Biology Vocab Matching (10 words per page)</h1>
    <div class="sub">
      <div class="pill">규칙: <b>왼쪽</b> 하나 클릭 → <b>오른쪽</b> 하나 클릭해서 매칭</div>
      <div class="pill">전체 단어: <b id="totalCount"></b>개</div>
      <div class="pill">맞춘 개수: <b id="matchedCount">0</b></div>
      <div class="pill">시도: <b id="tries">0</b></div>
      <div class="pill">시간: <b id="time">00:00</b></div>
    </div>
  </header>

  <div class="wrap">
    <div class="controls">
      <button id="resetBtn">전체 리셋</button>
      <button id="toggleModeBtn">모드 전환(한국어↔영어)</button>
    </div>

    <div class="progress">
      <div class="bar" id="bar"></div>
    </div>

    <div class="grid" style="margin-top: 12px;">
      <section class="col">
        <h2 id="leftTitle">English</h2>
        <div class="list" id="leftList"></div>
      </section>
      <section class="col">
        <h2 id="rightTitle">한국어</h2>
        <div class="list" id="rightList"></div>
      </section>
    </div>

    <div class="pagination">
      <button id="prevBtn">이전 페이지</button>
      <span class="page-info">페이지 <span id="currentPageNum">1</span> / <span id="totalPageNum">1</span></span>
      <button id="nextBtn">다음 페이지</button>
    </div>

    <div class="footer">
      총 120개의 단어가 12페이지에 걸쳐 제공됩니다.
    </div>
  </div>

<script>
  // 제공해주신 파일 4개의 데이터를 통합한 목록 (총 120개)
  const allPairs = [
    // Unit 01
    ["adaptation", "적응"], ["natural selection", "자연 선택"], ["speciation", "종 분화"], ["mutation", "돌연변이"], ["relict", "잔존 생물, 살아 있는 화석"], ["superorganism", "생물의 군집, 초개체"], ["colonization", "(동식물)의 군집 형성"], ["community", "군집"], ["symbiosis", "공생"], ["parasitism", "기생"], ["parasite", "기생충, 기생 생물"], ["commensalism", "편리공생"], ["mutualism", "상리공생"], ["epiphyte", "착생 식물"], ["niche", "(특정 생물이 살기에) 적합한 환경, 적소"], ["flora", "(특정 장소·시대·환경)의 식물군"], ["fauna", "(특정 장소·시대·환경)의 동물군"], ["biomass", "(특정 지역 내의) 생물량"], ["food web", "먹이 그물"], ["biological clock", "생체 시계"], ["circadian", "(24시간 주기로 변하는) 생물학적 주기의"], ["cell division", "세포 분열"], ["reproduction", "생식, 번식"], ["offspring", "자식, 새끼"], ["dormancy", "휴면, 비활동 상태"], ["organism", "유기체, 생물"], ["microorganism", "미생물"], ["fungus", "균류, 곰팡이류"], ["bacteria", "박테리아, 세균"], ["paleontology", "고생물학"],
    // Unit 02
    ["mammal", "포유동물"], ["cetacean", "고래목의 동물"], ["ruminant", "반추동물"], ["tusk", "엄니"], ["avian", "조류의"], ["plumage", "(새의) 깃털"], ["reptile", "파충류"], ["venom", "(뱀 등의) 독"], ["amphibian", "양서류"], ["gill", "(물고기의) 아가미"], ["fin", "(물고기의) 지느러미"], ["rodent", "설치류"], ["invertebrate", "무척추동물"], ["arthropod", "절지동물"], ["mollusk", "연체동물"], ["bivalve", "쌍각류 조개"], ["mate", "(새·동물의) 짝"], ["courtship", "(동물의 짝짓기를 위한) 구애"], ["breed", "새끼를 낳다, 사육하다, 품종"], ["fertilization", "수정"], ["hatchling", "갓 부화한 새끼"], ["feeding habit", "먹이 섭취 습성"], ["scavenger", "썩은 고기를 먹는 동물"], ["prey", "먹이, 사냥감"], ["bottom feeder", "강 바닥에서 먹이를 찾는 물고기"], ["endotherm", "온혈 동물"], ["hibernation", "겨울잠"], ["migration", "(동물·철새의) 이주, 이동"], ["vocalization", "(동물의) 발성, 소리"], ["echolocation", "반향 정위"],
    // Unit 03
    ["botany", "식물학"], ["seed", "씨앗, 종자"], ["spore", "홀씨, 포자"], ["germination", "발아"], ["pollen", "꽃가루"], ["photosynthesis", "광합성"], ["chlorophyll", "엽록소"], ["cellulose", "섬유소"], ["stem", "(식물의) 줄기"], ["petal", "꽃잎"], ["stoma", "(식물의 잎·줄기에 있는) 기공, 숨구멍"], ["vein", "(식물의) 맥"], ["taproot", "곧은 뿌리, 원뿌리"], ["perennial", "다년생 식물"], ["annual", "일년생 식물"], ["biennial", "이년생 식물"], ["vegetation", "초목"], ["cluster", "군생"], ["clump", "(수풀 등의) 덤불, 무리"], ["scrubland", "관목 지대"], ["canopy", "수관 (숲의 나뭇가지들이 지붕 모양으로 우거진 것)"], ["forest floor", "숲의 바닥"], ["deciduous", "낙엽성의"], ["evergreen", "상록수의"], ["conifer", "침엽수"], ["bark", "나무껍질"], ["root", "뿌리"], ["leaf", "잎"], ["branch", "나뭇가지"], ["trunk", "나무의 몸통"],
    // Unit 04
    ["complete metamorphosis", "완전 변태"], ["larvae", "유충"], ["caterpillar", "애벌레"], ["pupa", "번데기"], ["cocoon", "고치"], ["incomplete metamorphosis", "불완전 변태"], ["ecdysis", "탈피"], ["mimicry", "의태"], ["protective coloration", "보호색"], ["camouflage", "(보호색이나 형태 등을 통한) 위장"], ["microhabitat", "미소 서식지"], ["antennae", "(곤충의) 더듬이"], ["abdomen", "(곤충의) 배"], ["pollinator", "꽃가루 매개자"], ["nectar", "(꽃의) 꿀"], ["infested", "(해충 등이) 들끓는"], ["insecticide", "살충제"], ["exoskeleton", "외골격"], ["molting", "허물벗기"], ["thorax", "가슴"], ["mandible", "턱"], ["proboscis", "(곤충의) 긴 입"], ["wings", "날개"], ["swarm", "(곤충의) 떼"], ["hive", "벌집"], ["colony", "(개미 등의) 집단"], ["queen", "여왕 (개미/벌)"], ["worker", "일 (개미/벌)"], ["drone", "수벌"], ["larva", "애벌레 (단수)"]
  ];

  const $ = (id) => document.getElementById(id);

  // 상태 관리
  let mode = "EN_KO"; 
  let currentPage = 0;
  const itemsPerPage = 10;
  let matched = new Set(); 
  let tries = 0;
  let leftSelected = null;
  let rightSelected = null;
  let startAt = null;
  let timerId = null;

  // 유틸리티: 셔플
  const shuffle = (arr) => {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  };

  function escapeHtml(s) {
    return String(s).replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;").replaceAll('"', "&quot;").replaceAll("'", "&#039;");
  }

  // 타이머
  function formatTime(ms) {
    const total = Math.floor(ms / 1000);
    const m = String(Math.floor(total / 60)).padStart(2, "0");
    const s = String(total % 60).padStart(2, "0");
    return `${m}:${s}`;
  }

  function startTimerIfNeeded() {
    if (timerId) return;
    startAt = Date.now();
    timerId = setInterval(() => {
      $("time").textContent = formatTime(Date.now() - startAt);
    }, 250);
  }

  function stopTimerIfDone() {
    if (matched.size === allPairs.length && timerId) {
      clearInterval(timerId);
      timerId = null;
    }
  }

  // 데이터 렌더링
  function updateHUD() {
    $("totalCount").textContent = String(allPairs.length);
    $("matchedCount").textContent = String(matched.size);
    $("tries").textContent = String(tries);
    $("bar").style.width = `${(matched.size / allPairs.length) * 100}%`;
    
    // 페이지 정보 업데이트
    const totalPages = Math.ceil(allPairs.length / itemsPerPage);
    $("currentPageNum").textContent = currentPage + 1;
    $("totalPageNum").textContent = totalPages;
    $("prevBtn").disabled = (currentPage === 0);
    $("nextBtn").disabled = (currentPage === totalPages - 1);
  }

  function makeCard(item, side) {
    const div = document.createElement("div");
    div.className = "card";
    div.dataset.side = side;
    div.dataset.id = item.id; 

    div.innerHTML = `<span>${escapeHtml(item.text)}</span>`;

    if (matched.has(item.id)) div.classList.add("matched");

    div.addEventListener("click", () => onPick(div));
    return div;
  }

  function render() {
    const startIdx = currentPage * itemsPerPage;
    const endIdx = startIdx + itemsPerPage;
    const currentPairs = allPairs.slice(startIdx, endIdx);

    let leftTitle, rightTitle, leftItems, rightItems;

    if (mode === "EN_KO") {
      leftTitle = "English";
      rightTitle = "한국어";
      leftItems = currentPairs.map(p => ({ id: p[0], text: p[0] }));
      rightItems = currentPairs.map(p => ({ id: p[0], text: p[1] }));
    } else {
      leftTitle = "한국어";
      rightTitle = "English";
      leftItems = currentPairs.map(p => ({ id: p[0], text: p[1] }));
      rightItems = currentPairs.map(p => ({ id: p[0], text: p[0] }));
    }

    $("leftTitle").textContent = leftTitle;
    $("rightTitle").textContent = rightTitle;

    const leftList = $("leftList");
    const rightList = $("rightList");
    leftList.innerHTML = "";
    rightList.innerHTML = "";

    leftSelected = null;
    rightSelected = null;

    for (const item of shuffle(leftItems)) leftList.appendChild(makeCard(item, "left"));
    for (const item of shuffle(rightItems)) rightList.appendChild(makeCard(item, "right"));

    updateHUD();
  }

  function onPick(el) {
    const side = el.dataset.side;
    const id = el.dataset.id;

    if (matched.has(id)) return;
    startTimerIfNeeded();

    if (side === "left") {
      if (leftSelected) leftSelected.classList.remove("selected");
      leftSelected = el;
      el.classList.add("selected");
    } else {
      if (rightSelected) rightSelected.classList.remove("selected");
      rightSelected = el;
      el.classList.add("selected");
    }

    if (leftSelected && rightSelected) {
      tries += 1;
      const leftId = leftSelected.dataset.id;
      const rightId = rightSelected.dataset.id;

      if (leftId === rightId) {
        matched.add(leftId);
        markMatched(leftId);
        leftSelected = null;
        rightSelected = null;
        updateHUD();
        stopTimerIfDone();
      } else {
        leftSelected.classList.add("wrong");
        rightSelected.classList.add("wrong");
        setTimeout(() => {
          leftSelected?.classList.remove("wrong", "selected");
          rightSelected?.classList.remove("wrong", "selected");
          leftSelected = null;
          rightSelected = null;
        }, 260);
        updateHUD();
      }
    }
  }

  function markMatched(id) {
    document.querySelectorAll(`.card[data-id="${CSS.escape(id)}"]`).forEach(el => {
      el.classList.remove("selected");
      el.classList.add("matched");
    });
  }

  // 컨트롤 핸들러
  $("resetBtn").addEventListener("click", () => {
    if(!confirm("모든 기록을 리셋하시겠습니까?")) return;
    matched = new Set();
    tries = 0;
    currentPage = 0;
    $("time").textContent = "00:00";
    if (timerId) { clearInterval(timerId); timerId = null; }
    startAt = null;
    render();
  });

  $("toggleModeBtn").addEventListener("click", () => {
    mode = (mode === "EN_KO") ? "KO_EN" : "EN_KO";
    render();
  });

  $("prevBtn").addEventListener("click", () => {
    if (currentPage > 0) {
      currentPage--;
      render();
    }
  });

  $("nextBtn").addEventListener("click", () => {
    const totalPages = Math.ceil(allPairs.length / itemsPerPage);
    if (currentPage < totalPages - 1) {
      currentPage++;
      render();
    }
  });

  render();
</script>
</body>
</html>
