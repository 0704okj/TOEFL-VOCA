<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TOEFL Biology Vocab Matching</title>
  <style>
    :root { --gap: 10px; --radius: 14px; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#f6f7fb; color:#111; }
    header { padding: 18px 16px 8px; max-width: 1100px; margin: 0 auto; }
    h1 { margin: 0 0 8px; font-size: 18px; }
    .sub { display:flex; flex-wrap:wrap; gap:10px; align-items:center; font-size: 13px; color:#333; }
    .pill { background:#fff; border:1px solid #e7e7ef; border-radius:999px; padding:8px 10px; box-shadow: 0 1px 0 rgba(0,0,0,.03); }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 0 16px 18px; }

    .controls { display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin: 10px 0 14px; }
    button {
      border: 1px solid #dcdcec; background:#fff; padding:10px 12px;
      border-radius: 12px; cursor:pointer; font-weight:600;
      box-shadow: 0 1px 0 rgba(0,0,0,.03);
    }
    button:hover { filter: brightness(.98); }
    button:active { transform: translateY(1px); }
    button:disabled { opacity: 0.4; cursor: not-allowed; }

    .progress { height: 10px; background:#eef0f7; border-radius:999px; overflow:hidden; border:1px solid #e6e7f1; margin-bottom: 12px; }
    .bar { height:100%; width:0%; background: linear-gradient(90deg,#4c7dff,#8a5bff); transition: width .2s ease; }

    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: var(--gap); }
    @media (max-width: 820px) { .grid { grid-template-columns: 1fr; } }
    .col {
      background:#fff; border:1px solid #e7e7ef; border-radius: var(--radius);
      padding: 12px; box-shadow: 0 2px 10px rgba(0,0,0,.04);
    }
    .col h2 { margin: 2px 0 10px; font-size: 14px; color:#222; }
    .list { display:grid; grid-template-columns: 1fr; gap: 8px; min-height: 440px; }

    .card {
      border:1px solid #ececf5; border-radius: 12px; padding: 10px 12px;
      background:#fafbff; cursor:pointer; user-select:none;
      display:flex; justify-content:space-between; align-items:center; min-height: 22px;
    }
    .card.selected { outline: 2px solid #4c7dff; background:#eef3ff; }
    .card.matched { background:#ecfff1; border-color:#bfe7c8; color:#0b5b22; cursor:default; opacity:.8; }
    .card.wrong { animation: shake .25s linear 0s 1; outline: 2px solid #ff4c4c; background:#ffecec; }
    @keyframes shake { 0%{transform:translateX(0)} 25%{transform:translateX(-3px)} 50%{transform:translateX(3px)} 75%{transform:translateX(-2px)} 100%{transform:translateX(0)} }

    .pagination { display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 20px; padding: 10px; }
    .page-info { font-weight: 600; font-size: 14px; }
  </style>
</head>
<body>

  <header>
    <h1>TOEFL Biology Vocab Matching</h1>
    <div class="sub">
      <div class="pill">규칙: <b>왼쪽</b> 하나 클릭 → <b>오른쪽</b> 하나 클릭</div>
      <div class="pill">진행도: <b id="matchedCount">0</b> / <b id="totalCount">0</b></div>
      <div class="pill">시도: <b id="tries">0</b></div>
      <div class="pill">시간: <b id="time">00:00</b></div>
    </div>
  </header>

  <div class="wrap">
    <div class="controls">
      <button onclick="location.href='../'">← 메인으로</button>
      <button id="toggleModeBtn">모드 전환(EN/KO)</button>
      <button id="resetBtn">전체 리셋</button>
    </div>

    <div class="progress"><div class="bar" id="bar"></div></div>

    <div class="grid">
      <section class="col">
        <h2 id="leftTitle">English</h2>
        <div class="list" id="leftList"></div>
      </section>
      <section class="col">
        <h2 id="rightTitle">한국어</h2>
        <div class="list" id="rightList"></div>
      </section>
    </div>

    <div class="pagination">
      <button id="prevBtn">이전</button>
      <span class="page-info">Page <span id="currentPageNum">1</span> / <span id="totalPageNum">1</span></span>
      <button id="nextBtn">다음</button>
    </div>
  </div>

<script>
  const allPairs = [
    ["adaptation", "적응"],
    ["natural selection", "자연 선택"],
    ["speciation", "종 분화"],
    ["mutation", "돌연변이"],
    ["relict", "잔존 생물, 살아 있는 화석"],
    ["superorganism", "생물의 군집, 초개체"],
    ["colonization", "(동식물)의 군집 형성"],
    ["community", "군집"],
    ["symbiosis", "공생"],
    ["parasitism", "기생"],
    ["parasite", "기생충, 기생 생물"],
    ["commensalism", "편리공생"],
    ["mutualism", "상리공생"],
    ["epiphyte", "착생 식물"],
    ["niche", "(특정 생물이 살기에) 적합한 환경, 적소"],
    ["flora", "(특정 장소·시대·환경)의 식물군"],
    ["fauna", "(특정 장소·시대·환경)의 동물군"],
    ["biomass", "(특정 지역 내의) 생물량"],
    ["food web", "먹이 그물"],
    ["biological clock", "생체 시계"],
    ["circadian", "(24시간을 주기로 변하는 생물체의) 생물학적 주기"],
    ["cell division", "세포 분열"],
    ["reproduction", "생식, 번식"],
    ["offspring", "새끼, 자손"],
    ["dormancy", "휴면(상태), 비활동 상태"],
    ["organism", "유기체, 생물"],
    ["microorganism", "미생물"],
    ["fungus", "곰팡이류"],
    ["bacteria", "박테리아, 세균"],
    ["paleontology", "고생물학"]
  ];

  const $ = (id) => document.getElementById(id);

  let mode = "EN_KO";
  let currentPage = 0;
  const itemsPerPage = 10;

  let matched = new Set();
  let tries = 0;
  let leftSelected = null;
  let rightSelected = null;

  let startAt = null;
  let timerId = null;

  const shuffle = (arr) => {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  };

  function formatTime(ms) {
    const total = Math.floor(ms / 1000);
    const m = String(Math.floor(total / 60)).padStart(2, "0");
    const s = String(total % 60).padStart(2, "0");
    return `${m}:${s}`;
  }

  function updateHUD() {
    $("totalCount").textContent = String(allPairs.length);
    $("matchedCount").textContent = String(matched.size);
    $("tries").textContent = String(tries);
    $("bar").style.width = `${(matched.size / allPairs.length) * 100}%`;

    const totalPages = Math.ceil(allPairs.length / itemsPerPage);
    $("currentPageNum").textContent = currentPage + 1;
    $("totalPageNum").textContent = totalPages;
    $("prevBtn").disabled = (currentPage === 0);
    $("nextBtn").disabled = (currentPage === totalPages - 1);
  }

  function render() {
    const startIdx = currentPage * itemsPerPage;
    const currentPairs = allPairs.slice(startIdx, startIdx + itemsPerPage);

    const leftItems = mode === "EN_KO"
      ? currentPairs.map(p => ({ id: p[0], text: p[0] }))
      : currentPairs.map(p => ({ id: p[0], text: p[1] }));

    const rightItems = mode === "EN_KO"
      ? currentPairs.map(p => ({ id: p[0], text: p[1] }))
      : currentPairs.map(p => ({ id: p[0], text: p[0] }));

    $("leftTitle").textContent = mode === "EN_KO" ? "English" : "한국어";
    $("rightTitle").textContent = mode === "EN_KO" ? "한국어" : "English";

    const leftList = $("leftList");
    const rightList = $("rightList");
    leftList.innerHTML = "";
    rightList.innerHTML = "";

    leftSelected = null;
    rightSelected = null;

    shuffle(leftItems).forEach(item => leftList.appendChild(makeCard(item, "left")));
    shuffle(rightItems).forEach(item => rightList.appendChild(makeCard(item, "right")));

    updateHUD();
  }

  function makeCard(item, side) {
    const div = document.createElement("div");
    div.className = "card";
    div.dataset.id = item.id;     // ✅ 텍스트가 아니라 id로 매칭
    div.dataset.side = side;

    if (matched.has(item.id)) div.classList.add("matched");
    div.innerHTML = `<span>${item.text}</span>`;

    div.onclick = () => {
      if (matched.has(item.id)) return;

      if (!timerId) {
        startAt = Date.now();
        timerId = setInterval(() => {
          $("time").textContent = formatTime(Date.now() - startAt);
        }, 250);
      }

      if (side === "left") {
        if (leftSelected) leftSelected.classList.remove("selected");
        leftSelected = div;
      } else {
        if (rightSelected) rightSelected.classList.remove("selected");
        rightSelected = div;
      }
      div.classList.add("selected");

      if (leftSelected && rightSelected) {
        tries++;

        const ok = leftSelected.dataset.id === rightSelected.dataset.id;

        if (ok) {
          const matchId = leftSelected.dataset.id;
          matched.add(matchId);

          document.querySelectorAll(".card").forEach(c => {
            if (c.dataset.id === matchId) {
              c.classList.remove("selected");
              c.classList.add("matched");
            }
          });

          leftSelected = null;
          rightSelected = null;

          updateHUD();
          if (matched.size === allPairs.length) clearInterval(timerId);
        } else {
          const l = leftSelected, r = rightSelected;
          l.classList.add("wrong"); r.classList.add("wrong");
          setTimeout(() => {
            l.classList.remove("wrong", "selected");
            r.classList.remove("wrong", "selected");
          }, 300);
          leftSelected = null;
          rightSelected = null;

          updateHUD();
        }
      }
    };

    return div;
  }

  $("resetBtn").onclick = () => { if (confirm("초기화할까요?")) location.reload(); };
  $("toggleModeBtn").onclick = () => { mode = mode === "EN_KO" ? "KO_EN" : "EN_KO"; render(); };
  $("prevBtn").onclick = () => { if (currentPage > 0) { currentPage--; render(); } };
  $("nextBtn").onclick = () => {
    const totalPages = Math.ceil(allPairs.length / itemsPerPage);
    if (currentPage < totalPages - 1) { currentPage++; render(); }
  };

  render();
</script>
</body>
</html>
