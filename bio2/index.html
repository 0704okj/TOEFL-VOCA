<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TOEFL Biology Vocab Matching</title>
  <style>
    :root { --gap: 10px; --radius: 14px; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#f6f7fb; color:#111; }
    header { padding: 18px 16px 8px; max-width: 1100px; margin: 0 auto; }
    h1 { margin: 0 0 8px; font-size: 18px; }
    .sub { display:flex; flex-wrap:wrap; gap:10px; align-items:center; font-size: 13px; color:#333; }
    .pill { background:#fff; border:1px solid #e7e7ef; border-radius:999px; padding:8px 10px; box-shadow: 0 1px 0 rgba(0,0,0,.03); }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 0 16px 18px; }
    
    /* 상단 컨트롤 버튼 */
    .controls { display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin: 10px 0 14px; }
    button {
      border: 1px solid #dcdcec; background:#fff; padding:10px 12px;
      border-radius: 12px; cursor:pointer; font-weight:600;
      box-shadow: 0 1px 0 rgba(0,0,0,.03);
    }
    button:hover { filter: brightness(.98); }
    button:active { transform: translateY(1px); }
    button:disabled { opacity: 0.4; cursor: not-allowed; }

    /* 진행 바 */
    .progress { height: 10px; background:#eef0f7; border-radius:999px; overflow:hidden; border:1px solid #e6e7f1; margin-bottom: 12px; }
    .bar { height:100%; width:0%; background: linear-gradient(90deg,#4c7dff,#8a5bff); transition: width .2s ease; }

    /* 메인 그리드 */
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: var(--gap); }
    @media (max-width: 820px) { .grid { grid-template-columns: 1fr; } }
    .col {
      background:#fff; border:1px solid #e7e7ef; border-radius: var(--radius);
      padding: 12px; box-shadow: 0 2px 10px rgba(0,0,0,.04);
    }
    .col h2 { margin: 2px 0 10px; font-size: 14px; color:#222; }
    .list { display:grid; grid-template-columns: 1fr; gap: 8px; min-height: 440px; }

    /* 카드 디자인 */
    .card {
      border:1px solid #ececf5; border-radius: 12px; padding: 10px 12px;
      background:#fafbff; cursor:pointer; user-select:none;
      display:flex; justify-content:space-between; align-items:center; min-height: 22px;
    }
    .card.selected { outline: 2px solid #4c7dff; background:#eef3ff; }
    .card.matched { background:#ecfff1; border-color:#bfe7c8; color:#0b5b22; cursor:default; opacity:.8; }
    .card.wrong { animation: shake .25s linear 0s 1; outline: 2px solid #ff4c4c; background:#ffecec; }
    @keyframes shake { 0%{transform:translateX(0)} 25%{transform:translateX(-3px)} 50%{transform:translateX(3px)} 75%{transform:translateX(-2px)} 100%{transform:translateX(0)} }

    /* 페이지네이션 */
    .pagination { display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 20px; padding: 10px; }
    .page-info { font-weight: 600; font-size: 14px; }
    
    .nav-links { margin-top: 20px; }
    .nav-links a { color: #4c7dff; text-decoration: none; font-size: 14px; }
  </style>
</head>
<body>

  <header>
    <h1>TOEFL Biology Vocab Matching</h1>
    <div class="sub">
      <div class="pill">규칙: <b>왼쪽</b> 하나 클릭 → <b>오른쪽</b> 하나 클릭</div>
      <div class="pill">진행도: <b id="matchedCount">0</b> / <b id="totalCount">120</b></div>
      <div class="pill">시도: <b id="tries">0</b></div>
      <div class="pill">시간: <b id="time">00:00</b></div>
    </div>
  </header>

  <div class="wrap">
    <div class="controls">
      <button onclick="location.href='../'">← 메인으로</button>
      <button id="toggleModeBtn">모드 전환(EN/KO)</button>
      <button id="resetBtn">전체 리셋</button>
    </div>

    <div class="progress"><div class="bar" id="bar"></div></div>

    <div class="grid">
      <section class="col">
        <h2 id="leftTitle">English</h2>
        <div class="list" id="leftList"></div>
      </section>
      <section class="col">
        <h2 id="rightTitle">한국어</h2>
        <div class="list" id="rightList"></div>
      </section>
    </div>

    <div class="pagination">
      <button id="prevBtn">이전</button>
      <span class="page-info">Page <span id="currentPageNum">1</span> / <span id="totalPageNum">12</span></span>
      <button id="nextBtn">다음</button>
    </div>
  </div>

<script>
  // 통합된 120개 단어 데이터 (Unit 01 ~ 04)
  const allPairs = [
  ["mammal", "포유동물"], ["cetacean", "고래목의 동물"], ["ruminant", "반추동물"], ["tusk", "엄니"], ["avian", "조류의"], ["plumage", "(새의) 깃털"], ["reptile", "파충류"], ["venom", "(뱀 등의) 독"], ["amphibian", "양서류"], ["gill", "(물고기의) 아가미"], ["fin", "(물고기의) 지느러미"], ["rodent", "설치류"], ["invertebrate", "무척추동물"], ["arthropod", "절지동물"], ["mollusk", "연체동물"], ["bivalve", "쌍각류 조개"], ["mate", "(새·동물의) 짝"], ["courtship", "(동물의 짝짓기를 위한) 구애"], ["breed", "① 새끼를 낳다, 사육하다 ② (특히 개, 고양이 등의) 품종"], ["fertilization", "수정"], ["hatchling", "갓 부화한 새나 동물"], ["feeding habit", "먹이섭취 습성"], ["scavenger", "죽은 동물을 먹는 동물"], ["prey", "먹이, 사냥감"], ["bottom feeder", "강, 호수, 바다의 바닥에서 먹이를 찾는 물고기"], ["endotherm", "온혈 동물"], ["hibernation", "(동물의) 겨울잠"], ["migration", "(철새·동물의 대규모) 이주, 이동"], ["vocalization", "(동물이 발생하여 내는) 소리"], ["echolocation", "반향 정위"]
  ];

  const $ = (id) => document.getElementById(id);

  let mode = "EN_KO"; 
  let currentPage = 0;
  const itemsPerPage = 10;
  let matched = new Set(); 
  let tries = 0;
  let leftSelected = null;
  let rightSelected = null;
  let startAt = null;
  let timerId = null;

  const shuffle = (arr) => {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  };

  function formatTime(ms) {
    const total = Math.floor(ms / 1000);
    const m = String(Math.floor(total / 60)).padStart(2, "0");
    const s = String(total % 60).padStart(2, "0");
    return `${m}:${s}`;
  }

  function updateHUD() {
    $("totalCount").textContent = String(allPairs.length);
    $("matchedCount").textContent = String(matched.size);
    $("tries").textContent = String(tries);
    $("bar").style.width = `${(matched.size / allPairs.length) * 100}%`;
    
    const totalPages = Math.ceil(allPairs.length / itemsPerPage);
    $("currentPageNum").textContent = currentPage + 1;
    $("totalPageNum").textContent = totalPages;
    $("prevBtn").disabled = (currentPage === 0);
    $("nextBtn").disabled = (currentPage === totalPages - 1);
  }

  function render() {
    const startIdx = currentPage * itemsPerPage;
    const currentPairs = allPairs.slice(startIdx, startIdx + itemsPerPage);

    let leftItems = mode === "EN_KO" ? currentPairs.map(p => ({ id: p[0], text: p[0] })) : currentPairs.map(p => ({ id: p[0], text: p[1] }));
    let rightItems = mode === "EN_KO" ? currentPairs.map(p => ({ id: p[0], text: p[1] })) : currentPairs.map(p => ({ id: p[0], text: p[0] }));

    $("leftTitle").textContent = mode === "EN_KO" ? "English" : "한국어";
    $("rightTitle").textContent = mode === "EN_KO" ? "한국어" : "English";

    const leftList = $("leftList");
    const rightList = $("rightList");
    leftList.innerHTML = "";
    rightList.innerHTML = "";

    leftSelected = null;
    rightSelected = null;

    shuffle(leftItems).forEach(item => leftList.appendChild(makeCard(item, "left")));
    shuffle(rightItems).forEach(item => rightList.appendChild(makeCard(item, "right")));

    updateHUD();
  }

  function makeCard(item, side) {
    const div = document.createElement("div");
    div.className = "card";
    if (matched.has(item.id)) div.classList.add("matched");
    div.innerHTML = `<span>${item.text}</span>`;
    div.onclick = () => {
      if (matched.has(item.id)) return;
      if (!timerId) { startAt = Date.now(); timerId = setInterval(() => { $("time").textContent = formatTime(Date.now() - startAt); }, 250); }

      if (side === "left") {
        if (leftSelected) leftSelected.classList.remove("selected");
        leftSelected = div;
      } else {
        if (rightSelected) rightSelected.classList.remove("selected");
        rightSelected = div;
      }
      div.classList.add("selected");

      if (leftSelected && rightSelected) {
        tries++;
        if (leftSelected.innerText === (mode === "EN_KO" ? item.id : allPairs.find(p=>p[0]===item.id)[1]) && 
            rightSelected.innerText === (mode === "EN_KO" ? allPairs.find(p=>p[0]===item.id)[1] : item.id) || 
            (allPairs.find(p=>p[0]===leftSelected.innerText || p[1]===leftSelected.innerText)[0] === allPairs.find(p=>p[0]===rightSelected.innerText || p[1]===rightSelected.innerText)[0])) {
          
          const matchId = allPairs.find(p=>p[0]===leftSelected.innerText || p[1]===leftSelected.innerText)[0];
          matched.add(matchId);
          document.querySelectorAll(".card").forEach(c => {
             const txt = c.innerText;
             const p = allPairs.find(pair => pair[0] === txt || pair[1] === txt);
             if(p && p[0] === matchId) {
               c.classList.remove("selected");
               c.classList.add("matched");
             }
          });
          leftSelected = null; rightSelected = null;
          updateHUD();
          if (matched.size === allPairs.length) clearInterval(timerId);
        } else {
          const l = leftSelected, r = rightSelected;
          l.classList.add("wrong"); r.classList.add("wrong");
          setTimeout(() => { l.classList.remove("wrong", "selected"); r.classList.remove("wrong", "selected"); }, 300);
          leftSelected = null; rightSelected = null;
        }
      }
    };
    return div;
  }

  $("resetBtn").onclick = () => { if(confirm("초기화할까요?")) location.reload(); };
  $("toggleModeBtn").onclick = () => { mode = mode === "EN_KO" ? "KO_EN" : "EN_KO"; render(); };
  $("prevBtn").onclick = () => { if(currentPage > 0) { currentPage--; render(); } };
  $("nextBtn").onclick = () => { if(currentPage < Math.ceil(allPairs.length/itemsPerPage)-1) { currentPage++; render(); } };

  render();
</script>
</body>
</html>
